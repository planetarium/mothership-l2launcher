  redis:
    extends:
      file: ./services/docker-compose-redis.yml
      service: redis

  postgres:
    extends:
      file: ./services/docker-compose-postgres.yml
      service: postgres

  blockscout:
    image: blockscout/blockscout:latest
    container_name: 'blockscout'
    depends_on:
      - postgres
      - smart-contract-verifier
      - redis
      - op-geth
    command: sh -c "bin/blockscout eval \"Elixir.Explorer.ReleaseTasks.create_and_migrate()\" && bin/blockscout start"
    env_file:
      -  ./envs/common-blockscout.env
    environment:
      CHAIN_ID: ${L2_CHAIN_ID}
      ETHEREUM_JSONRPC_VARIANT: 'geth'
      ETHEREUM_JSONRPC_HTTP_URL: http://op-geth:8545/
      ETHEREUM_JSONRPC_TRACE_URL: http://op-geth:8545/
      DATABASE_URL: postgresql://postgres:@postgres:5432/blockscout?ssl=false
      ECTO_USE_SSL: 'false'
      SECRET_KEY_BASE: '56NtB48ear7+wMSf0IQuWDAAazhpb31qyc7GiyspBP2vh7t5zlCsF5QDv76chXeN'
      MIX_ENV: 'prod'
    ports:
      - 4000:4000
    volumes:
      - ./data/blockscout/logs/:/app/logs/

  smart-contract-verifier:
    extends:
      file: ./services/docker-compose-smart-contract-verifier.yml
      service: smart-contract-verifier

  visualizer:
    extends:
      file: ./services/docker-compose-visualizer.yml
      service: visualizer

  sig-provider:
    extends:
      file: ./services/docker-compose-sig-provider.yml
      service: sig-provider
